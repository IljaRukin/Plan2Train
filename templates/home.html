<!DOCTYPE html>
<html lang="en">
<head>

<meta charset='utf-8' />

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>-->

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script>

    var password = "";
    function toggleEditing(){
      if (password) {
        password = "";
        document.getElementById("dropElements").style.display = "none";
      } else {
        password = prompt('Master Password:');
        document.getElementById("dropElements").style.display = "block";
      }
    };

/*    function captureMouseClick(element){
      element.addEventListener("mousedown", function (e) {
        if (password) {
          var isRightMB = false;
          e = e || window.event;

          //decide if left or right click
          if ("which" in e) { // Gecko (Firefox), WebKit (Safari/Chrome) & Opera
            isRightMB = e.which == 3;
          }
          else if ("button" in e) { // IE, Opera 
            isRightMB = e.button == 2;
          } else { // default: left click

          }

          //process click
          if (isRightMB) {
            //edit entry
          } else {
            //delete entry
          }

        } 
      })
    };

    const sessionEntries = document.getElementsByClassName("fc-daygrid-event-harness");
    for (let i = 0; i < sessionEntries.length; i++) {
      captureMouseClick(sessionEntries.item(i));
    }
    */

  document.addEventListener('DOMContentLoaded', function() {
    var Calendar = FullCalendar.Calendar;
    var DraggableSidebar = FullCalendar.Draggable;
    var DraggableSessions = FullCalendar.Draggable;

    var containerEl = document.getElementById('external-events');
    var calendarEl = document.getElementById('calendar');
    //var checkbox = document.getElementById('drop-remove');

    new DraggableSidebar(containerEl, {
      itemSelector: '.fc-event',
      eventData: function(eventEl) {
        return {
          title: eventEl.innerText,
          color: eventEl.style.backgroundColor
        };
      }
    });
  
    new DraggableSessions(calendarEl, {
      itemSelector: ".fc-event",
      eventData: function(eventEl) {
        return {
          title: eventEl.innerText,
          color: eventEl.style.backgroundColor
        };
      }
    });

    var Calendar = new FullCalendar.Calendar(calendarEl, {
      headerToolbar: {
        left: 'prevYear,prev,next,nextYear today',
        center: 'title',
        right: 'multiMonthYear,dayGridMonth'
      },
      firstDay: 1, //(Monday)
      editable: false,
      droppable: true,
      selectable: true,
      businessHours: true,
      dayMaxEvents: true,
      initialView: 'dayGridMonth',
      weekends: true,
      events: [
        {
          title: 'Click for Google',
          url: 'http://google.com/',
          start: '2024-07-28',
          color: 'green'
        }
      ],
      allDaySlot: false,
      selectHelper: true,
    //-----edit/remove entry on click into event-----
      eventClick: function(info){
        if (password) {
          if (confirm("Do you want to remove the event ?") == true) {
          	var date = info.event.start.toISOString().slice(0,10);
//          $.get("/removeEntry?title="+info.event.title+"?date="+date+?masterPassword="+password, function(data){
            $.ajax({
              url: "/removeEntry",
              type: "get",
              data: {title: info.event.title, date: date, masterPassword: password},
              success: function(response) {
                console.log("removed entry from database successfully");
                info.event.remove();
              },
              error: function(xhr) {
                console.log("failed to remove entry from database");
              }
            });
          } else {
            console.log("canceled removing event");
          }
        }
      },
      //-----add entry on click into calendar-----
      select: function(event) {
        if (password) {
          if (confirm("Do you want to add an event ?") == true) {
            var title = prompt('Event Title:');
          	var date = event.start.toISOString().slice(0,10);
//          $.get("/addEntry?title="+title+"?date="+date+?masterPassword="+password, function(data){
            $.ajax({
              url: "/addEntry",
              type: "get",
              data: {title: title, date: date, masterPassword: password},
              success: function(response) {
                console.log("added entry to database successfully");
                Calendar.addEvent({
                  title: title,
                  start: event.start,
                  allDay: event.allDay,
                  color: 'blue'
                });
              },
              error: function(xhr) {
                console.log("failed to add entry to database");
              }
            });
          } else {
            console.log("canceled adding event");
          }
        }
      },
      drop: function(info) {
        if (false) { //remove oroginal element
          info.draggedEl.parentNode.removeChild(info.draggedEl);
        }
      }
//    dateClick: this.handleDateClick.bind(this),
//    dateClick:function (info) {
//        console.log("See day infos: ",info);
//    }
    });

    Calendar.render();

  });

</script>
<style>

/*  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }*/

  html, body {
    margin: 0;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #dropElements{
    display: none;
  }

  #external-events {
/*    position: relative;
    width: 10%;
    margin-right: 90%;
    z-index: 2;
    top: 20px;
    left: 20px;
    width: 150px;
    padding: 0 10px;
    border: 1px solid #ccc;
    background: #eee;*/
  }

  #external-events .fc-event {
/*    cursor: move;
    margin: 3px 0;*/
  }

  #calendar-container {
/*    position: relative;
    width: 90%;
    min-width:500px;
    margin-left: 10%;*/
  }

  #calendar {
/*    margin: 20px auto;*/
  }

</style>
</head>
<body>

<div class="container text-center" style="width:100%;">

  <div class="row" id="header">
    <h1>Plan 2 Train</h1>
    <p>Welcome {{ current_user.username }}!</p>
    <a href="/logout">Logout</a> | <a href="#" onclick="toggleEditing();return false;">edit</a>
  </div>

  <div class="row" id="planning">
    <div class="col-md-1" id="dropElements">
      <div id='external-events'>
        <p>
          <strong>Sessions</strong>
        </p>
        <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event' style="background-color:blue;">
          <div class='fc-event-main'>GA1</div>
        </div>
        <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event' style="background-color:green;">
          <div class='fc-event-main'>GA2</div>
        </div>
        <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event' style="background-color:yellow;">
          <div class='fc-event-main'>GA3</div>
        </div>
        <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event' style="background-color:red;">
          <div class='fc-event-main'>GA4</div>
        </div>
        <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event' style="background-color:violet;">
          <div class='fc-event-main'>GA5</div>
        </div>
        <!--<p>
          <input type='checkbox' id='drop-remove' />
          <label for='drop-remove'>remove after drop</label>
        </p>-->
      </div>
    </div>

    <div class="col-md-11">
      <div id='calendar-container'>
        <div id='calendar'></div>
      </div>
    </div>
  </div>

</body>
</html>
